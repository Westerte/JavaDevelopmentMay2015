package edu.nesterenko.parcer.logic;

import java.util.ArrayList;
import java.util.Collections;
import java.util.Comparator;
import java.util.HashMap;
import java.util.List;
import java.util.Map;

import edu.nesterenko.parcer.entity.Component;
import edu.nesterenko.parcer.entity.Composite;
import edu.nesterenko.parcer.entity.Leaf;
import edu.nesterenko.parcer.exception.LogicalException;

public class TextFinder {
	public static List<String> findSentenceOrderedByWordCount(Parser parser) throws LogicalException {
		Component root = parser.getHierarchy();
		Map<Component, Integer> sentenceWordCountMap = new HashMap<Component, Integer>();
		findSentencesOrderedByWordCount(root, sentenceWordCountMap);
		List<Map.Entry<Component, Integer>> entrySetList = new ArrayList<Map.Entry<Component, Integer>>(sentenceWordCountMap.entrySet());
		Comparator<Map.Entry<Component, Integer>> comp = 
				(Map.Entry<Component, Integer> o1, Map.Entry<Component, Integer> o2) 
				-> 
				o1.getValue() - o2.getValue();
		Collections.sort(entrySetList, comp);
		List<String> result = new ArrayList<String>();
		for(Map.Entry<Component, Integer> entry : entrySetList) {
			Component component = entry.getKey();
			result.add(TextReviver.reviveText(component));
		}
		return result;		
	}
	private static void findSentencesOrderedByWordCount(Component father, Map<Component, Integer>  sentenceWordCountMap) {
		for(Component component : father) {
			if("sentence".equals(component.getName() )){
				sentenceWordCountMap.put(component, takeComponentsCountOfType("word", (Composite)component));
				continue;
			}
			if(component instanceof Composite) {
				findSentencesOrderedByWordCount(component, sentenceWordCountMap);
			}			
		}
	}
	private static int takeComponentsCountOfType(String name, Composite composite) {
		int result = 0;
		for(Component component : composite) {
			if(component.getName() == name) { 
				result++;
			}
		}
		return result;
	}
}
